---
title: "TP : Interaction avec l'API Star Wars"
description: "Apprenez √† interagir avec une API REST en JavaScript en utilisant l'API Star Wars (SWAPI)"
---

import Rendu from "../../../components/rendu.astro";

## Introduction √† l'API SWAPI

SWAPI (Star Wars API) est une API REST gratuite qui fournit des donn√©es sur l'univers Star Wars. Dans ce TP, nous allons apprendre √† :

- Utiliser la fonction `fetch` pour faire des requ√™tes HTTP
- Manipuler les promesses avec `then`
- Afficher des donn√©es dynamiquement sur une page web
- Interagir avec une API via des entr√©es utilisateur

## 1. Les bases de fetch

La fonction `fetch` est int√©gr√©e aux navigateurs modernes et permet de faire des requ√™tes HTTP. Voici un exemple simple :

```javascript
fetch("https://swapi.dev/api/people/1")
  .then((response) => response.json())
  .then((data) => console.log(data));
```

<Rendu
  script={`
fetch('https://swapi.dev/api/people/1')
    .then(response => response.json())
    .then(data => {
        const consoleLog = document.getElementById('console-log');
        consoleLog.innerHTML = JSON.stringify(data, null, 2);
    });
`}
>
  <pre id="console-log"></pre>
</Rendu>

Analysons ce code :

1. `fetch('https://swapi.dev/api/people/1')` fait une requ√™te GET √† l'URL sp√©cifi√©e
2. Le premier `.then` convertit la r√©ponse en JSON
3. Le second `.then` re√ßoit les donn√©es et les affiche dans la console

Lisez la documentation de la fonction [`fetch`](https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch) pour comprendre en profondeur comment elle fonctionne, et posez des questions !

## 2. Afficher les donn√©es sur la page

Maintenant, affichons ces donn√©es de mani√®re plus √©l√©gante :

```html
<div id="personnage">Chargement...</div>

<script>
  const personnageDiv = document.getElementById("personnage");

  fetch("https://swapi.dev/api/people/1")
    .then((response) => response.json())
    .then((data) => {
      // TODO: impl√©menter le code
      personnageDiv.innerHTML = `
            ...
            `;
    });
</script>
```

Vous pourrez utiliser la m√©thode [`innerHTML`](https://developer.mozilla.org/fr/docs/Web/API/Element/innerHTML) pour modifier le contenu de l'√©l√©ment `personnageDiv`, √† vous de jouer !.

Par exemple, vous pourrez afficher le nom du personnage, sa taille, son poids et sa couleur des yeux:

<Rendu
  script={`
const personnageDiv = document.getElementById('personnage');
fetch('https://swapi.dev/api/people/1')
    .then(response => response.json())
    .then(data => {
        personnageDiv.innerHTML = \`
            <h2>\${data.name}</h2>
            <ul>
                <li>Taille : \${data.height} cm</li>
                <li>Poids : \${data.mass} kg</li>
                <li>Couleur des yeux : \${data.eye_color}</li>
            </ul>
        \`;
    });
`}
>
  <div id="personnage">Chargement...</div>
</Rendu>

## 3. Version interactive

Cr√©ons maintenant une version o√π l'utilisateur peut choisir quel personnage afficher :

```html
<div class="swapi-interface">
  <input type="number" id="characterId" value="1" min="1" />
  <button id="loadButton">Charger le personnage</button>
  <div id="characterInfo">
    Entrez un ID et cliquez sur le bouton pour charger un personnage
  </div>
</div>

<script>
  const characterIdInput = document.getElementById("characterId");
  const loadButton = document.getElementById("loadButton");
  const characterInfo = document.getElementById("characterInfo");

  function loadCharacter() {
    // TODO: impl√©menter la fonction
    // 1. R√©cup√©rer l'ID depuis l'input
    // 2. Faire la requ√™te fetch avec cet ID
    // 3. Afficher les informations dans characterInfo
    // 4. G√©rer les erreurs si le personnage n'existe pas
  }

  loadButton.addEventListener("click", loadCharacter);
</script>

<style>
  .swapi-interface {
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  .swapi-interface input {
    padding: 5px;
    margin-right: 10px;
  }

  .swapi-interface button {
    padding: 5px 10px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  #characterInfo {
    margin-top: 20px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 4px;
  }
</style>
```

<Rendu style={`
.swapi-interface {
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.swapi-interface input {
padding: 5px;
margin-right: 10px;
}

.swapi-interface button {
padding: 5px 10px;
background: #007bff;
color: white;
border: none;
border-radius: 4px;
cursor: pointer;
}

#characterInfo {
margin-top: 20px;
padding: 10px;
background: #f8f9fa;
border-radius: 4px;
}
`} script={`
const characterIdInput = document.getElementById('characterId');
const loadButton = document.getElementById('loadButton');
const characterInfo = document.getElementById('characterInfo');

function loadCharacter() {
const id = characterIdInput.value;
characterInfo.innerHTML = 'Chargement...';

    fetch(\`https://swapi.dev/api/people/\${id}\`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Personnage non trouv√©');
            }
            return response.json();
        })
        .then(data => {
            characterInfo.innerHTML = \`
                <h2>\${data.name}</h2>
                <ul>
                    <li>Taille : \${data.height} cm</li>
                    <li>Poids : \${data.mass} kg</li>
                    <li>Couleur des yeux : \${data.eye_color}</li>
                    <li>Ann√©e de naissance : \${data.birth_year}</li>
                </ul>
            \`;
        })
        .catch(error => {
            characterInfo.innerHTML = \`<p style="color: red">\${error.message}</p>\`;
        });

}

loadButton.addEventListener('click', loadCharacter);
`}>

  <div class="swapi-interface">
    <input type="number" id="characterId" value="1" min="1" />
    <button id="loadButton">Charger le personnage</button>
    <div id="characterInfo">
      Entrez un ID et cliquez sur le bouton pour charger un personnage
    </div>
  </div>
</Rendu>

Pour compl√©ter l'exercice, vous devrez :

1. Impl√©menter la fonction `loadCharacter`
2. Utiliser `fetch` avec l'ID du personnage
3. Afficher les informations dans l'√©l√©ment `characterInfo`
4. G√©rer les erreurs si le personnage n'existe pas

üí° Astuce : Utilisez la m√©thode `catch` pour g√©rer les erreurs :

```javascript
fetch(url)
    .then(...)
    .catch(error => {
        console.error('Erreur :', error);
    });
```

## Pour aller plus loin

Voici quelques id√©es d'am√©liorations :

1. Ajouter un indicateur de chargement
2. Ajouter des boutons "Pr√©c√©dent" et "Suivant"
3. Afficher les vaisseaux du personnage (disponibles dans `data.starships`)
4. Ajouter une traduction des termes en fran√ßais
5. Am√©liorer le style avec CSS
